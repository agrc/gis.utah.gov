---
import CardForBlog from '@components/page/CardForBlog.astro';
import Layout from '@layouts/BlogPostIndex.astro';
import { getBlogFilters, type DecoratedBlogEntry } from '@utils/collections';
import type { GetStaticPathsResult } from 'astro';
import { fromMarkdown } from 'mdast-util-from-markdown';
import { toString } from 'mdast-util-to-string';

interface Props {
  tag: string;
  posts: DecoratedBlogEntry[];
}

export async function getStaticPaths(): Promise<GetStaticPathsResult> {
  const tags = await getBlogFilters('tags');

  return tags.map((tag) => ({
    params: {
      slug: tag.slug,
    },
    props: {
      tag: tag.name,
      posts: tag.posts,
    },
  }));
}

const { tag, posts } = Astro.props;
---

<Layout title="Posts by category" category={tag}>
  {
    posts.map((post) => (
      <CardForBlog
        title={post.data.title}
        description={toString(fromMarkdown(post.body)).slice(0, 200) ?? 'a blog post'}
        date={post.data.date}
        slug={post.slug}
        estimatedReadingTime={post.data.estimatedReadTime}
        category={post.data.category}
        tags={post.data.tags}
      />
    ))
  }
</Layout>
